"use strict";var activityApp=activityApp||{};activityApp.controllers=angular.module("activityControllers",["ui.bootstrap"]),activityApp.controllers.controller("MyProfileCtrl",function(e,t,i,a){e.submitted=!1,e.loading=!1,e.initialProfile={},e.genderOptions=[{value:"Male",label:"Male"},{value:"Female",label:"Female"},{value:"Third",label:"Third"},{value:"You_Guess",label:"You Guess"}],e.init=function(){var t=function(){e.profile={},e.loading=!0,gapi.client.activity.getProfile().execute(function(t){e.$apply(function(){e.loading=!1,t.error||(e.profile.displayName=t.result.displayName,e.profile.gender=t.result.gender,e.initialProfile=t.result)})})};if(i.signedIn)t();else{var a=i.showLoginModal();a.result.then(t)}},e.saveProfile=function(){e.submitted=!0,e.loading=!0,gapi.client.activity.saveProfile(e.profile).execute(function(s){e.$apply(function(){if(e.loading=!1,s.error){var n=s.error.message||"";if(e.messages="Failed to update a profile : "+n,e.alertStatus="warning",t.error(e.messages+"Profile : "+JSON.stringify(e.profile)),s.code&&s.code==a.UNAUTHORIZED)return void i.showLoginModal()}else e.messages="The profile has been updated",e.alertStatus="success",e.submitted=!1,e.initialProfile={displayName:e.profile.displayName,gender:e.profile.gender},t.info(e.messages+JSON.stringify(s.result))})})}}),activityApp.controllers.controller("CreateActivityCtrl",function(e,t,i,a){e.activity=e.activity||{},e.topics=["General Social","Eating","Gamming","Chatting","Indoor","Outdoor"],e.isValidMaxAttendees=function(){return e.activity.maxAttendees&&0!=e.activity.maxAttendees.length?/^[\d]+$/.test(e.activity.maxAttendees)&&e.activity.maxAttendees>=0:!0},e.isValidDates=function(){return e.activity.startDate||e.activity.endDate?e.activity.startDate&&!e.activity.endDate?!0:e.activity.startDate<=e.activity.endDate:!0},e.isValidActivity=function(t){return!t.$invalid&&e.isValidMaxAttendees()&&e.isValidDates()},e.createActivity=function(s){e.isValidActivity(s)&&(e.loading=!0,gapi.client.activity.createActivity(e.activity).execute(function(s){e.$apply(function(){if(e.loading=!1,s.error){var n=s.error.message||"";if(e.messages="Failed to create a activity : "+n,e.alertStatus="warning",t.error(e.messages+" Activity : "+JSON.stringify(e.activity)),s.code&&s.code==a.UNAUTHORIZED)return void i.showLoginModal()}else e.messages="The activity has been created : "+s.result.name,e.alertStatus="success",e.submitted=!1,e.activity={},t.info(e.messages+" : "+JSON.stringify(s.result))})}))}}),activityApp.controllers.controller("ShowActivityCtrl",function(e,t,i,a){e.submitted=!1,e.selectedTab="ALL",e.filters=[],e.filtereableFields=[{enumValue:"LOCATION",displayName:"Location"},{enumValue:"TOPIC",displayName:"Topic"},{enumValue:"MONTH",displayName:"Start month"},{enumValue:"MAX_ATTENDEES",displayName:"Max Attendees"}],e.operators=[{displayName:"=",enumValue:"EQ"},{displayName:">",enumValue:"GT"},{displayName:">=",enumValue:"GTEQ"},{displayName:"<",enumValue:"LT"},{displayName:"<=",enumValue:"LTEQ"},{displayName:"!=",enumValue:"NE"}],e.activities=[],e.isOffcanvasEnabled=!1,e.tabAllSelected=function(){e.selectedTab="ALL",e.queryActivities()},e.tabYouHaveCreatedSelected=function(){return e.selectedTab="YOU_HAVE_CREATED",i.signedIn?void e.queryActivities():void i.showLoginModal()},e.tabYouWillAttendSelected=function(){return e.selectedTab="YOU_WILL_ATTEND",i.signedIn?void e.queryActivities():void i.showLoginModal()},e.toggleOffcanvas=function(){e.isOffcanvasEnabled=!e.isOffcanvasEnabled},e.pagination=e.pagination||{},e.pagination.currentPage=0,e.pagination.pageSize=20,e.pagination.numberOfPages=function(){return Math.ceil(e.activities.length/e.pagination.pageSize)},e.pagination.pageArray=function(){for(var t=[],i=e.pagination.numberOfPages(),a=0;i>a;a++)t.push(a);return t},e.pagination.isDisabled=function(e){return angular.element(e.target).hasClass("disabled")},e.addFilter=function(){e.filters.push({field:e.filtereableFields[0],operator:e.operators[0],value:""})},e.clearFilters=function(){e.filters=[]},e.removeFilter=function(t){e.filters[t]&&e.filters.splice(t,1)},e.queryActivities=function(){e.submitted=!1,"ALL"==e.selectedTab?e.queryActivitiesAll():"YOU_HAVE_CREATED"==e.selectedTab?e.getActivitiesCreated():"YOU_WILL_ATTEND"==e.selectedTab&&e.getActivitiesAttend()},e.queryActivitiesAll=function(){for(var i={filters:[]},a=0;a<e.filters.length;a++){var s=e.filters[a];s.field&&s.operator&&s.value&&i.filters.push({field:s.field.enumValue,operator:s.operator.enumValue,value:s.value})}e.loading=!0,gapi.client.activity.queryActivities(i).execute(function(a){e.$apply(function(){if(e.loading=!1,a.error){var s=a.error.message||"";e.messages="Failed to query activities : "+s,e.alertStatus="warning",t.error(e.messages+" filters : "+JSON.stringify(i))}else e.submitted=!1,e.messages="Query succeeded : "+JSON.stringify(i),e.alertStatus="success",t.info(e.messages),e.activities=[],angular.forEach(a.items,function(t){e.activities.push(t)});e.submitted=!0})})},e.getActivitiesCreated=function(){e.loading=!0,gapi.client.activity.getActivitiesCreated().execute(function(s){e.$apply(function(){if(e.loading=!1,s.error){var n=s.error.message||"";if(e.messages="Failed to query the activities created : "+n,e.alertStatus="warning",t.error(e.messages),s.code&&s.code==a.UNAUTHORIZED)return void i.showLoginModal()}else e.submitted=!1,e.messages="Query succeeded : activities you have created",e.alertStatus="success",t.info(e.messages),e.activities=[],angular.forEach(s.items,function(t){e.activities.push(t)});e.submitted=!0})})},e.getActivitiesAttend=function(){e.loading=!0,gapi.client.activity.getActivitiesToAttend().execute(function(s){e.$apply(function(){if(s.error){var n=s.error.message||"";if(e.messages="Failed to query the activities to attend : "+n,e.alertStatus="warning",t.error(e.messages),s.code&&s.code==a.UNAUTHORIZED)return void i.showLoginModal()}else e.activities=s.result.items,e.loading=!1,e.messages="Query succeeded : activities you will attend (or you have attended)",e.alertStatus="success",t.info(e.messages);e.submitted=!0})})}}),activityApp.controllers.controller("ActivityDetailCtrl",function(e,t,i,a){e.activity={},e.isUserAttending=!1,e.init=function(){e.loading=!0,gapi.client.activity.getActivity({websafeActivityKey:i.websafeActivityKey}).execute(function(a){e.$apply(function(){if(e.loading=!1,a.error){var s=a.error.message||"";e.messages="Failed to get the activity : "+i.websafeKey+" "+s,e.alertStatus="warning",t.error(e.messages)}else e.alertStatus="success",e.activity=a.result})}),e.loading=!0,gapi.client.activity.getProfile().execute(function(t){e.$apply(function(){if(e.loading=!1,t.error);else for(var a=t.result,s=0;s<a.activityKeysToAttend.length;s++)i.websafeActivityKey==a.activityKeysToAttend[s]&&(e.alertStatus="info",e.messages="You are attending this activity",e.isUserAttending=!0)})})},e.registerForActivity=function(){e.loading=!0,gapi.client.activity.registerForActivity({websafeActivityKey:i.websafeActivityKey}).execute(function(i){e.$apply(function(){if(e.loading=!1,i.error){var s=i.error.message||"";if(e.messages="Failed to register for the activity : "+s,e.alertStatus="warning",t.error(e.messages),i.code&&i.code==a.UNAUTHORIZED)return void oauth2Provider.showLoginModal()}else i.result?(e.messages="Registered for the activity",e.alertStatus="success",e.isUserAttending=!0,e.activity.seatsAvailable=e.activity.seatsAvailable-1):(e.messages="Failed to register for the activity",e.alertStatus="warning")})})},e.unregisterFromActivity=function(){e.loading=!0,gapi.client.activity.unregisterFromActivity({websafeActivityKey:i.websafeActivityKey}).execute(function(s){e.$apply(function(){if(e.loading=!1,s.error){var n=s.error.message||"";if(e.messages="Failed to unregister from the activity : "+n,e.alertStatus="warning",t.error(e.messages),s.code&&s.code==a.UNAUTHORIZED)return void oauth2Provider.showLoginModal()}else if(s.result)e.messages="Unregistered from the activity",e.alertStatus="success",e.activity.seatsAvailable=e.activity.seatsAvailable+1,e.isUserAttending=!1,t.info(e.messages);else{var n=s.error.message||"";e.messages="Failed to unregister from the activity : "+i.websafeKey+" : "+n,e.messages="Failed to unregister from the activity",e.alertStatus="warning",t.error(e.messages)}})})}}),activityApp.controllers.controller("RootCtrl",function(e,t,i){e.isActive=function(e){return e===t.path()},e.getSignedInState=function(){return i.signedIn},e.signIn=function(){i.signIn(function(){gapi.client.oauth2.userinfo.get().execute(function(t){e.$apply(function(){t.email&&(i.signedIn=!0,e.alertStatus="success",e.rootMessages="Logged in with "+t.email)})})})},e.initSignInButton=function(){gapi.signin.render("signInButton",{callback:function(){jQuery("#signInButton button").attr("disabled","true").css("cursor","default"),gapi.auth.getToken()&&gapi.auth.getToken().access_token&&e.$apply(function(){i.signedIn=!0})},clientid:i.CLIENT_ID,cookiepolicy:"single_host_origin",scope:i.SCOPES})},e.signOut=function(){i.signOut(),e.alertStatus="success",e.rootMessages="Logged out"},e.collapseNavbar=function(){angular.element(document.querySelector(".navbar-collapse")).removeClass("in")}}),activityApp.controllers.controller("OAuth2LoginModalCtrl",function(e,t,i,a){e.singInViaModal=function(){a.signIn(function(){gapi.client.oauth2.userinfo.get().execute(function(i){e.$root.$apply(function(){a.signedIn=!0,e.$root.alertStatus="success",e.$root.rootMessages="Logged in with "+i.email}),t.close()})})}}),activityApp.controllers.controller("DatepickerCtrl",function(e){e.today=function(){e.dt=new Date},e.today(),e.clear=function(){e.dt=null},e.disabled=function(e,t){return"day"===t&&(0===e.getDay()||6===e.getDay())},e.toggleMin=function(){e.minDate=e.minDate?null:new Date},e.toggleMin(),e.open=function(t){t.preventDefault(),t.stopPropagation(),e.opened=!0},e.dateOptions={"year-format":"'yy'","starting-day":1}});